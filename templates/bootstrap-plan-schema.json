{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "type": "object",
  "required": ["version", "spec_file", "kits"],
  "properties": {
    "version": { "const": 1 },
    "spec_file": { "type": "string" },
    "spec_hash": { "type": "string" },
    "kits": {
      "type": "array",
      "items": { "enum": ["tdd", "research", "math"] },
      "minItems": 1
    },
    "tdd": {
      "type": "object",
      "required": ["build_order"],
      "properties": {
        "language": { "type": "string" },
        "test_framework": { "type": "string" },
        "build_cmd": { "type": "string" },
        "test_cmd": { "type": "string" },
        "build_order": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": ["step", "description", "spec_file"],
            "properties": {
              "step": { "type": "integer", "minimum": 1 },
              "description": { "type": "string" },
              "spec_file": { "type": "string" }
            }
          }
        }
      }
    },
    "research": {
      "type": "object",
      "properties": {
        "goal": { "type": "string" },
        "questions": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["priority", "question", "decision_gate"],
            "properties": {
              "priority": { "type": "string", "pattern": "^P\\d+$" },
              "question": { "type": "string" },
              "decision_gate": { "type": "string" }
            }
          }
        },
        "constraints": { "type": "object" }
      }
    },
    "math": {
      "type": "object",
      "properties": {
        "domain": { "type": "string" },
        "constructions": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["priority", "construction", "spec_file"],
            "properties": {
              "priority": { "type": "string", "pattern": "^P\\d+$" },
              "construction": { "type": "string" },
              "spec_file": { "type": "string" },
              "depends_on": {
                "type": "array",
                "items": { "type": "string" }
              }
            }
          }
        }
      }
    }
  }
}
